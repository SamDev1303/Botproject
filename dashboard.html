<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella OS | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { bella: { bg: '#050505', surface: '#0d0d0d', border: '#1a1a1a', accent: '#6366f1', warning: '#f59e0b', success: '#10b981' } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #f1f1f1; font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; display: flex; flex-direction: column; padding: 6px; gap: 6px; overflow: hidden; }
        .glass { background: rgba(13, 13, 13, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; }
        .accent-text { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 10px; }
        .status-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <!-- ULTRA-COMPACT HEADER -->
    <header class="glass px-4 py-2 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-6">
            <h1 class="text-lg font-black italic accent-text tracking-tighter uppercase leading-none">BELLA OS</h1>
            <div class="flex gap-4 overflow-x-auto no-scrollbar items-center border-l border-white/10 pl-6" id="stock-ticker">
                <!-- Ticker -->
            </div>
        </div>
        <div class="flex items-center gap-8">
            <div class="flex gap-4">
                <div class="text-right">
                    <p class="text-[8px] font-bold text-gray-500 uppercase tracking-widest">Revenue</p>
                    <span class="text-xs font-black text-white" id="stat-revenue">--</span>
                </div>
                <div class="text-right border-l border-white/10 pl-4">
                    <p class="text-[8px] font-bold text-gray-500 uppercase tracking-widest">Unpaid</p>
                    <span class="text-xs font-black text-bella-warning" id="stat-invoices">--</span>
                </div>
                <div class="text-right border-l border-white/10 pl-4">
                    <p class="text-[8px] font-bold text-gray-500 uppercase tracking-widest">Leads</p>
                    <span class="text-xs font-black text-bella-success" id="stat-leads">--</span>
                </div>
            </div>
            <div class="flex items-center gap-3 border-l border-white/10 pl-6">
                <div class="w-1.5 h-1.5 bg-bella-success rounded-full shadow-[0_0_8px_#10b981] status-pulse"></div>
                <span class="text-[9px] font-mono text-gray-300 uppercase" id="last-update">--:--:--</span>
            </div>
        </div>
    </header>

    <!-- FULL HEIGHT GRID -->
    <main class="flex-1 grid grid-cols-12 gap-2 min-h-0">
        <!-- LEFT: NEURAL STREAMS (ACTIVE OPS) -->
        <section class="col-span-4 flex flex-col gap-2 min-h-0">
            <div class="glass p-3 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-1 mb-2 uppercase">
                    <h2 class="text-[9px] font-black text-gray-500 tracking-widest">Neural Streams</h2>
                    <i class="fas fa-wave-square text-bella-accent text-[9px] animate-pulse"></i>
                </div>
                <div id="task-list" class="flex-1 overflow-y-auto custom-scroll space-y-2">
                    <!-- Tasks -->
                </div>
            </div>
            <div class="glass p-3 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-1 mb-2 uppercase">
                    <h2 class="text-[9px] font-black text-gray-500 tracking-widest">Active Crons</h2>
                    <span class="text-[8px] font-mono text-gray-600" id="cron-count">0 ACTIVE</span>
                </div>
                <div id="cron-list" class="flex-1 overflow-y-auto custom-scroll space-y-2">
                    <!-- Crons -->
                </div>
            </div>
        </section>

        <!-- CENTER: PATTERN MEMORY (CORE INTELLIGENCE) -->
        <section class="col-span-5 flex flex-col min-h-0">
            <div class="glass p-3 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-1 mb-2 uppercase">
                    <h2 class="text-[9px] font-black text-gray-500 tracking-widest">Intelligence Patterns</h2>
                    <i class="fas fa-brain text-bella-accent text-[9px]"></i>
                </div>
                <div id="history-list" class="flex-1 overflow-y-auto custom-scroll space-y-3">
                    <!-- Patterns -->
                </div>
            </div>
        </section>

        <!-- RIGHT: PORTFOLIO & SYSTEM HEALTH -->
        <section class="col-span-3 flex flex-col gap-2 min-h-0">
            <div class="glass p-3 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-1 mb-2 uppercase">
                    <h2 class="text-[9px] font-black text-gray-500 tracking-widest">Portfolio Deep Dive</h2>
                    <i class="fas fa-chart-line text-bella-accent text-[9px]"></i>
                </div>
                <div id="stock-list-side" class="space-y-2 flex-1 overflow-y-auto custom-scroll">
                    <!-- Stock Detailed -->
                </div>
            </div>
            <div class="glass p-3 shrink-0">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-[9px] font-bold text-gray-500 uppercase tracking-widest tracking-tighter">System Health</span>
                    <span class="text-[9px] font-mono text-bella-success">OPTIMAL</span>
                </div>
                <div class="flex flex-col gap-1 text-[9px] font-mono text-gray-400">
                    <div class="flex justify-between"><span>Model</span><span class="text-white">Gemini-3-Flash</span></div>
                    <div class="flex justify-between"><span>Latency</span><span class="text-white">124ms</span></div>
                    <div class="flex justify-between"><span>Security</span><span class="text-bella-success">VERIFIED</span></div>
                </div>
            </div>
        </section>
    </main>

    <script>
        async function loadData() {
            try {
                const response = await fetch('dashboard-data.json?t=' + Date.now());
                const data = await response.json();
                
                document.getElementById('last-update').innerText = new Date(data.updatedAt).toLocaleTimeString();
                document.getElementById('stat-revenue').innerText = data.stats?.revenueMTD || '--';
                document.getElementById('stat-invoices').innerText = data.stats?.unpaidInvoices || '--';
                document.getElementById('stat-leads').innerText = data.stats?.leads || '--';

                if (data.portfolio) {
                    const ticker = document.getElementById('stock-ticker');
                    ticker.innerHTML = data.portfolio.map(s => `
                        <div class="flex items-center gap-1.5 whitespace-nowrap">
                            <span class="text-[10px] font-black text-white uppercase tracking-tighter">${s.ticker}</span>
                            <span class="text-[10px] font-mono ${s.change >= 0 ? 'text-bella-success' : 'text-red-500'}">${s.change >= 0 ? '▲' : '▼'}${Math.abs(s.change)}%</span>
                        </div>
                    `).join('<div class="w-px h-2 bg-white/10 mx-2"></div>');

                    const sideList = document.getElementById('stock-list-side');
                    sideList.innerHTML = data.portfolio.map(s => `
                        <div class="p-2 bg-white/[0.02] border border-white/5 rounded-lg flex justify-between items-center">
                            <div><p class="text-[10px] font-bold text-white uppercase tracking-tighter">${s.name}</p></div>
                            <div class="text-right">
                                <p class="text-[10px] font-mono text-white">$${s.price}</p>
                                <p class="text-[8px] font-mono ${s.change >= 0 ? 'text-bella-success' : 'text-red-500'}">${s.change >= 0 ? '+' : ''}${s.change}%</p>
                            </div>
                        </div>
                    `).join('');
                }

                const cronList = document.getElementById('cron-list');
                document.getElementById('cron-count').innerText = data.crons.length + ' ACTIVE';
                cronList.innerHTML = data.crons.map(c => `
                    <div class="p-2 bg-white/[0.03] border border-white/5 rounded-lg">
                        <div class="flex justify-between items-center">
                            <span class="text-[9px] font-black text-white uppercase truncate w-2/3 tracking-tighter">${c.name}</span>
                            <span class="text-[8px] font-mono text-bella-accent">${c.schedule.expr}</span>
                        </div>
                        <p class="text-[9px] text-gray-500 line-clamp-1 mt-1">${c.payload.text || c.payload.message || ''}</p>
                    </div>
                `).join('');

                const taskList = document.getElementById('task-list');
                taskList.innerHTML = data.liveTasks.map(t => `
                    <div class="p-2 bg-white/[0.03] border border-yellow-500/10 rounded-lg">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[9px] font-black text-yellow-500 uppercase tracking-tighter">${t.label}</span>
                            <i class="fas fa-circle-notch fa-spin text-[7px] text-yellow-600"></i>
                        </div>
                        <p class="text-[10px] text-gray-300 font-semibold mb-1 truncate">${t.status}</p>
                        <div class="w-full bg-black/40 rounded-full h-0.5"><div class="bg-yellow-500 h-0.5 rounded-full" style="width: 75%"></div></div>
                    </div>
                `).join('');

                const historyList = document.getElementById('history-list');
                historyList.innerHTML = data.patterns.map(p => `
                    <div class="p-2.5 rounded-lg border-l-2 border-bella-success/30 bg-white/[0.02]">
                        <p class="text-[10px] text-gray-300 leading-tight mb-1 font-medium">"${p.description}"</p>
                        <div class="flex justify-between items-center">
                            <span class="text-[8px] font-black text-gray-500 uppercase font-mono tracking-widest">${p.date}</span>
                            <i class="fas fa-check-double text-[8px] text-bella-success/50"></i>
                        </div>
                    </div>
                `).join('');

            } catch (e) { console.error("Sync Error", e); }
        }
        setInterval(loadData, 30000);
        loadData();
    </script>
</body>
</html>
