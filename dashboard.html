<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella OS | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { bella: { bg: '#050505', surface: '#0d0d0d', border: '#1a1a1a', accent: '#6366f1', warning: '#f59e0b', success: '#10b981' } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #f1f1f1; font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; display: flex; flex-direction: column; padding: 12px; gap: 12px; overflow: hidden; }
        .glass { background: rgba(13, 13, 13, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; }
        .accent-text { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 10px; }
        .status-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    </style>
</head>
<body>
    <!-- COMPACT TOP BAR -->
    <header class="glass p-4 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-black italic accent-text tracking-tighter uppercase leading-none">BELLA OS</h1>
            <div class="h-4 w-px bg-white/10"></div>
            <div class="flex gap-4 overflow-x-auto no-scrollbar" id="stock-ticker">
                <!-- Dynamic Stocks -->
            </div>
        </div>
        <div class="flex items-center gap-6">
            <div class="text-right">
                <p class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Gateway Status</p>
                <div class="flex items-center justify-end gap-2">
                    <span class="text-[10px] font-mono text-bella-success">SYNCED</span>
                    <div class="w-2 h-2 bg-bella-success rounded-full shadow-[0_0_8px_#10b981] status-pulse"></div>
                </div>
            </div>
            <div class="text-right">
                <p class="text-[9px] font-bold text-gray-500 uppercase tracking-widest">Last Update</p>
                <span class="text-[10px] font-mono text-gray-300 uppercase" id="last-update">--:--:--</span>
            </div>
        </div>
    </header>

    <!-- MAIN GRID: MAXIMIZED SPACE -->
    <main class="flex-1 grid grid-cols-12 gap-3 min-h-0">
        <!-- LEFT: BUSINESS VITALS -->
        <section class="col-span-3 flex flex-col gap-3 min-h-0">
            <div class="glass p-4 flex-1 flex flex-col gap-4">
                <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest border-b border-white/5 pb-2">Business Vitals</h2>
                <div class="grid grid-cols-1 gap-3">
                    <div class="p-3 rounded-xl bg-white/5 border border-white/5">
                        <p class="text-[9px] text-gray-500 uppercase font-bold mb-1">MTD Revenue</p>
                        <h3 class="text-xl font-black text-white" id="stat-revenue">--</h3>
                    </div>
                    <div class="p-3 rounded-xl bg-white/5 border border-white/5">
                        <p class="text-[9px] text-gray-500 uppercase font-bold mb-1">Unpaid Balance</p>
                        <h3 class="text-xl font-black text-bella-warning" id="stat-invoices">--</h3>
                    </div>
                    <div class="p-3 rounded-xl bg-white/5 border border-white/5">
                        <p class="text-[9px] text-gray-500 uppercase font-bold mb-1">New Leads</p>
                        <h3 class="text-xl font-black text-bella-success" id="stat-leads">--</h3>
                    </div>
                </div>
            </div>
            <div class="glass p-4 shrink-0">
                <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest border-b border-white/5 pb-2 mb-3">Portfolio Insight</h2>
                <div id="stock-list-side" class="space-y-2">
                    <!-- Dynamic Stock Side List -->
                </div>
            </div>
        </section>

        <!-- CENTER: ACTIVE OPERATIONS -->
        <section class="col-span-6 flex flex-col gap-3 min-h-0">
            <div class="glass p-4 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-2 mb-3">
                    <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Neural Streams</h2>
                    <span class="text-[9px] font-mono text-bella-accent">LIVE_OPS</span>
                </div>
                <div id="task-list" class="flex-1 overflow-y-auto custom-scroll space-y-3 pr-2">
                    <!-- Dynamic Tasks -->
                </div>
            </div>
            <div class="glass p-4 flex-1 flex flex-col min-h-0">
                <div class="flex justify-between items-center border-b border-white/5 pb-2 mb-3">
                    <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Active Crons</h2>
                    <span class="text-[9px] font-mono text-gray-600" id="cron-count">0 ACTIVE</span>
                </div>
                <div id="cron-list" class="flex-1 overflow-y-auto custom-scroll space-y-3 pr-2">
                    <!-- Dynamic Crons -->
                </div>
            </div>
        </section>

        <!-- RIGHT: PATTERN MEMORY -->
        <section class="col-span-3 flex flex-col min-h-0">
            <div class="glass p-4 flex-1 flex flex-col min-h-0">
                <h2 class="text-[10px] font-black text-gray-500 uppercase tracking-widest border-b border-white/5 pb-2 mb-3">Pattern Memory</h2>
                <div id="history-list" class="flex-1 overflow-y-auto custom-scroll space-y-4 pr-2">
                    <!-- Dynamic History -->
                </div>
            </div>
        </section>
    </main>

    <script>
        async function loadData() {
            try {
                const response = await fetch('dashboard-data.json?t=' + Date.now());
                const data = await response.json();
                
                document.getElementById('last-update').innerText = new Date(data.updatedAt).toLocaleTimeString();
                document.getElementById('stat-revenue').innerText = data.stats?.revenueMTD || '--';
                document.getElementById('stat-invoices').innerText = data.stats?.unpaidInvoices || '--';
                document.getElementById('stat-leads').innerText = data.stats?.leads || '--';

                // Render Top Ticker
                if (data.portfolio) {
                    const ticker = document.getElementById('stock-ticker');
                    ticker.innerHTML = data.portfolio.map(s => `
                        <div class="flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/5 whitespace-nowrap">
                            <span class="text-[10px] font-black text-white uppercase">${s.ticker}</span>
                            <span class="text-[10px] font-mono ${s.change >= 0 ? 'text-bella-success' : 'text-red-500'}">${s.change >= 0 ? '▲' : '▼'}${Math.abs(s.change)}%</span>
                        </div>
                    `).join('');

                    const sideList = document.getElementById('stock-list-side');
                    sideList.innerHTML = data.portfolio.slice(0, 4).map(s => `
                        <div class="flex justify-between items-center">
                            <span class="text-[10px] font-bold text-gray-300 uppercase">${s.name}</span>
                            <span class="text-[10px] font-mono text-white">$${s.price}</span>
                        </div>
                    `).join('');
                }

                // Render Crons
                const cronList = document.getElementById('cron-list');
                document.getElementById('cron-count').innerText = data.crons.length + ' ACTIVE';
                cronList.innerHTML = data.crons.map(c => `
                    <div class="p-3 bg-white/[0.03] border border-white/5 rounded-xl">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[10px] font-black text-white uppercase truncate w-2/3">${c.name}</span>
                            <span class="text-[8px] font-mono text-bella-accent">${c.schedule.expr}</span>
                        </div>
                        <p class="text-[10px] text-gray-500 line-clamp-1">${c.payload.text || c.payload.message || ''}</p>
                    </div>
                `).join('');

                // Render Tasks
                const taskList = document.getElementById('task-list');
                taskList.innerHTML = data.liveTasks.map(t => `
                    <div class="p-3 bg-white/[0.03] border border-yellow-500/10 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-black text-yellow-500 uppercase tracking-tighter">${t.label}</span>
                            <i class="fas fa-circle-notch fa-spin text-[8px] text-yellow-600"></i>
                        </div>
                        <p class="text-[11px] text-gray-300 font-medium mb-2">${t.status}</p>
                        <div class="w-full bg-black/40 rounded-full h-1"><div class="bg-yellow-500 h-1 rounded-full" style="width: 65%"></div></div>
                    </div>
                `).join('');

                // Render History
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = data.patterns.map(p => `
                    <div class="p-3 rounded-xl border-l-2 border-bella-success/30 bg-white/[0.02]">
                        <p class="text-[10px] text-gray-400 italic mb-1">"${p.description}"</p>
                        <span class="text-[8px] font-black text-gray-600 uppercase font-mono tracking-widest">${p.date}</span>
                    </div>
                `).join('');

            } catch (e) { console.error("Sync Error", e); }
        }
        setInterval(loadData, 30000);
        loadData();
    </script>
</body>
</html>
